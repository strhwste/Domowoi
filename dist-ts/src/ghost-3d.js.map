{"version":3,"file":"ghost-3d.js","sourceRoot":"","sources":["../../src/ghost-3d.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,EAAE,UAAU,EAAE,MAAM,0CAA0C,CAAC;AAatE,MAAM,OAAO,OAAO;IAsBlB,YAAY,OAAuB;QAf3B,wBAAmB,GAAW,CAAC,CAAC;QAChC,4BAAuB,GAAW,MAAM,CAAC,CAAC,mBAAmB;QAK7D,oBAAe,GAAkB,IAAI,CAAC;QACtC,YAAO,GAAW,EAAE,CAAC;QAS3B,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;QACnC,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;QACjC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;QAC7B,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,IAAI,GAAG,CAAC;QAC5C,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,IAAI,GAAG,CAAC;QAChD,IAAI,CAAC,mBAAmB,GAAG,OAAO,CAAC,mBAAmB,IAAI,GAAG,CAAC;QAC9D,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QACnD,IAAI,CAAC,QAAQ,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;QAC1E,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAC3D,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;QACtD,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC5B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACtB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,CAAC;QACtD,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACrD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAEO,UAAU;QAChB,MAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;QAChC,MAAM,CAAC,IAAI,CACT,IAAI,CAAC,QAAQ,EACb,CAAC,IAA+B,EAAE,EAAE;YAClC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACxB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;YACjD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;YACxE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC3B,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACvC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,IAAI,IAAI,CAAC,MAAM;gBAAE,IAAI,CAAC,MAAM,EAAE,CAAC;QACjC,CAAC,CACF,CAAC;IACJ,CAAC;IAED,WAAW,CAAC,QAAuB;QACjC,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;QAChC,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;QACnC,6BAA6B;IAC/B,CAAC;IAED,MAAM,CAAC,GAAW;QAChB,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;QACnB,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;IACjC,CAAC;IAED,MAAM,CAAC,KAAa,EAAE,MAAc;QAClC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;IACvC,CAAC;IAED,OAAO;QACL,IAAI,IAAI,CAAC,WAAW;YAAE,oBAAoB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAC7D,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACxB,oCAAoC;QACpC,qCAAqC;QACrC,GAAG;QACH,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACrC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACxC,CAAC;QACD,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACrC,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;IACvD,CAAC;IAEO,mBAAmB,CAAC,QAAuB;QACjD,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAO;QACxB,0CAA0C;QAC1C,IAAI,KAAK,GAAG,QAAQ,CAAC;QACrB,QAAQ,QAAQ,EAAE,CAAC;YACjB,KAAK,OAAO;gBAAE,KAAK,GAAG,QAAQ,CAAC;gBAAC,MAAM,CAAC,cAAc;YACrD,KAAK,MAAM;gBAAE,KAAK,GAAG,QAAQ,CAAC;gBAAC,MAAM,CAAC,eAAe;YACrD,KAAK,MAAM;gBAAE,KAAK,GAAG,QAAQ,CAAC;gBAAC,MAAM,CAAC,eAAe;YACrD,KAAK,IAAI;gBAAE,KAAK,GAAG,QAAQ,CAAC;gBAAC,MAAM;QACrC,CAAC;QACD,MAAM,QAAQ,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAQ,EAAE,EAAE;YAC/B,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC;gBAC/B,GAAG,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;gBAC/B,IAAI,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;oBAC1B,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;gBACtC,CAAC;YACH,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAEK,aAAa;QACjB,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAO;QACxB,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QACvB,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC;YACzE,6CAA6C;YAC7C,IAAI,GAAG,GAAG,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,uBAAuB,EAAE,CAAC;gBAChE,gEAAgE;gBAChE,OAAO;YACX,CAAC;YACD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC1C,CAAC;QACD,IAAI,CAAC,mBAAmB,GAAG,GAAG,CAAC;QAE/B,yBAAyB;QACzB,MAAM,WAAW,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;QACrE,MAAM,WAAW,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QACrE,MAAM,GAAG,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;QACrD,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAC7B,MAAM,OAAO,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QAClE,MAAM,IAAI,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;QAClD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAChC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEd,qBAAqB;QACrB,MAAM,OAAO,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;QAClC,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QAClE,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QAClE,YAAY;QACZ,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,gBAAgB,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC;QAC1F,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QAC/B,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACtC,aAAa;QACb,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;QAC5B,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC;QACxB,SAAS;QACT,MAAM,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;QACnF,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACnC,WAAW;QACX,MAAM,IAAI,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,QAAQ,CAAC,CAAC;QAC/E,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QAC9B,YAAY;QACZ,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC;QAC1B,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QAC/B,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAE9C,2CAA2C;QAC3C,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;QAChE,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QACnE,MAAM,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QACpD,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAChC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QAEhC,mBAAmB;QACnB,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;QACnC,SAAS;QACT,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,cAAc,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QACzF,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QACrG,MAAM,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QACpD,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QACnC,QAAQ;QACR,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;QACpE,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QAClE,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACjD,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAClC,SAAS;QACT,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;QACvE,MAAM,SAAS,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QACnE,MAAM,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QACpD,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACtC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QAChC,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;QAEpC,kDAAkD;QAClD,MAAM,WAAW,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;QACtC,MAAM,YAAY,GAAI,MAAc,CAAC,qBAAqB,IAAI,EAAE,CAAC;QACjE,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,YAAY;QAClC,IAAI,YAAY,CAAC,KAAK;YAAE,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACjD,IAAI,OAAO,YAAY,CAAC,GAAG,KAAK,QAAQ,IAAI,YAAY,CAAC,GAAG,GAAG,EAAE;YAAE,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3F,IAAI,YAAY,CAAC,IAAI;YAAE,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACjD,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAC5B,mFAAmF;QACnF,IAAI,CAAC,aAAa,GAAG,WAAoC,CAAC;IAC9D,CAAC;IACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MA8BE;IACQ,mBAAmB,CAAC,IAAY;QACtC,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACrD,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,GAAG,CAAC;QAC9B,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,EAAE,CAAC;QAC9B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACpD,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAChC,IAAI,CAAC,aAAa,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC1D,IAAI,CAAC,aAAa,CAAC,WAAW,GAAG,IAAI,CAAC;QACtC,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACnD,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,aAAa,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC;QAC7F,IAAI,CAAC,UAAU,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACrD,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC7D,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;IAEO,oBAAoB,CAAC,IAAY;QACvC,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,OAAO;QAClD,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;QAC3B,MAAM,OAAO,GAAG,EAAE,CAAC;QACnB,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,OAAO,GAAG,CAAC,CAAC;QACvD,MAAM,UAAU,GAAG,EAAE,CAAC;QACtB,MAAM,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,CAAC,CAAC;QACtC,MAAM,MAAM,GAAG,EAAE,CAAC;QAElB,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACvE,GAAG,CAAC,SAAS,GAAG,wBAAwB,CAAC;QACzC,GAAG,CAAC,WAAW,GAAG,uBAAuB,CAAC;QAC1C,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;QAElB,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACnB,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;QACpB,GAAG,CAAC,gBAAgB,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;QACvC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;QACpB,GAAG,CAAC,gBAAgB,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;QACvC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACnB,GAAG,CAAC,gBAAgB,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QACrC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACnB,GAAG,CAAC,gBAAgB,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QACrC,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,IAAI,EAAE,CAAC;QACX,GAAG,CAAC,MAAM,EAAE,CAAC;QAEb,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;QACpB,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACrB,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;QACpB,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,IAAI,EAAE,CAAC;QACX,GAAG,CAAC,MAAM,EAAE,CAAC;QAEb,GAAG,CAAC,IAAI,GAAG,sBAAsB,CAAC;QAClC,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC;QACvB,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC;QACzB,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;QAE5B,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;QAClD,MAAM,UAAU,GAAG,KAAK,CAAC,MAAM,GAAG,UAAU,CAAC;QAC7C,MAAM,OAAO,GAAG,MAAM,GAAG,CAAC,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;QAE/C,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC,EAAE,EAAE;YACxB,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,EAAE,OAAO,GAAG,CAAC,GAAG,UAAU,CAAC,CAAC;QAClD,CAAC,CAAC,CAAC;QAEH,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,IAAI,CAAC,aAAa,CAAC,WAAW,GAAG,IAAI,CAAC;QACxC,CAAC;IACH,CAAC;IAEO,SAAS,CAAC,GAA6B,EAAE,IAAY,EAAE,QAAgB;QAC7E,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC9B,MAAM,KAAK,GAAa,EAAE,CAAC;QAC3B,IAAI,IAAI,GAAG,EAAE,CAAC;QAEd,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACtC,MAAM,QAAQ,GAAG,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;YACvC,MAAM,OAAO,GAAG,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAC1C,IAAI,OAAO,CAAC,KAAK,GAAG,QAAQ,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;gBACtC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;gBACxB,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;YACxB,CAAC;iBAAM,CAAC;gBACN,IAAI,GAAG,QAAQ,CAAC;YAClB,CAAC;QACH,CAAC;QACD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;QACxB,OAAO,KAAK,CAAC;IACf,CAAC;IAEO,aAAa;QACnB,OAAO,CAAC,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,eAAe,IAAI,QAAQ,CAAC,eAAe,KAAK,SAAS,CAAC,CAAC,CAAC;IACpG,CAAC;IAEO,QAAQ;QACd,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAO;QACxB,MAAM,SAAS,GAAG,GAAG,EAAE;YACrB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;gBAC1B,IAAI,CAAC,WAAW,GAAG,qBAAqB,CAAC,SAAS,CAAC,CAAC;gBACpD,OAAO;YACT,CAAC;YACD,MAAM,CAAC,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,KAAK,CAAC;YACpC,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;gBACpD,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;gBAChD,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC;YACnD,CAAC;YACD,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;gBACvB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;gBAClC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;YACpC,CAAC;YACD,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;gBAClC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACnD,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACnD,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,CAAC;gBACzD,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC/C,CAAC;YACD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC9C,IAAI,CAAC,WAAW,GAAG,qBAAqB,CAAC,SAAS,CAAC,CAAC;QACtD,CAAC,CAAC;QACF,SAAS,EAAE,CAAC;IACd,CAAC;CACF","sourcesContent":["import * as THREE from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\n\nexport type GhostPriority = 'ok' | 'info' | 'warn' | 'alert';\n\nexport interface Ghost3DOptions {\n  container: HTMLElement;\n  modelUrl: string;\n  onLoad?: () => void;\n  modelScale?: number;\n  modelYOffset?: number;\n  speechBubbleYOffset?: number;\n}\n\nexport class Ghost3D {\n  private scene: THREE.Scene;\n  private renderer: THREE.WebGLRenderer;\n  private camera: THREE.PerspectiveCamera;\n  private model?: THREE.Object3D;\n  private animationId?: number;\n  private accessoryMesh?: THREE.Mesh;\n  private lastAccessoryUpdate: number = 0;\n  private accessoryUpdateInterval: number = 600000; // 10 Minuten in ms\n  private speechMesh?: THREE.Mesh;\n  private speechTexture?: THREE.Texture;\n  private speechCanvas?: HTMLCanvasElement;\n  private speechCtx?: CanvasRenderingContext2D | null;\n  private currentPriority: GhostPriority = 'ok';\n  private lastTip: string = '';\n  private container: HTMLElement;\n  private modelUrl: string;\n  private onLoad?: () => void;\n  private modelScale: number;\n  private modelYOffset: number;\n  private speechBubbleYOffset: number;\n\n  constructor(options: Ghost3DOptions) {\n    this.container = options.container;\n    this.modelUrl = options.modelUrl;\n    this.onLoad = options.onLoad;\n    this.modelScale = options.modelScale ?? 1.2;\n    this.modelYOffset = options.modelYOffset ?? 0.5;\n    this.speechBubbleYOffset = options.speechBubbleYOffset ?? 1.4;\n    this.scene = new THREE.Scene();\n    this.scene.fog = new THREE.Fog(0x99ccff, 2.5, 6.5);\n    this.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });\n    this.renderer.setClearColor(0x000000, 0);\n    this.renderer.setSize(320, 320);\n    this.camera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);\n    this.camera.position.set(0, 1, 3);\n    const light = new THREE.DirectionalLight(0xffffff, 1);\n    light.position.set(0, 2, 2);\n    this.scene.add(light);\n    this.scene.add(new THREE.AmbientLight(0xffffff, 0.7));\n    this.container.appendChild(this.renderer.domElement);\n    this._loadModel();\n  }\n\n  private _loadModel() {\n    const loader = new GLTFLoader();\n    loader.load(\n      this.modelUrl,\n      (gltf: { scene: THREE.Object3D }) => {\n        this.model = gltf.scene;\n        this.model.position.set(0, this.modelYOffset, 0);\n        this.model.scale.set(this.modelScale, this.modelScale, this.modelScale);\n        this.scene.add(this.model);\n        this._addAccessory();\n        this._createSpeechBubble(this.lastTip);\n        this._animate();\n        if (this.onLoad) this.onLoad();\n      }\n    );\n  }\n\n  setPriority(priority: GhostPriority) {\n    this.currentPriority = priority;\n    this._setColorByPriority(priority);\n    //this._updateGlow(priority);\n  }\n\n  setTip(tip: string) {\n    this.lastTip = tip;\n    this._updateSpeechTexture(tip);\n  }\n\n  resize(width: number, height: number) {\n    this.renderer.setSize(width, height);\n  }\n\n  dispose() {\n    if (this.animationId) cancelAnimationFrame(this.animationId);\n    this.renderer.dispose();\n    //if (this.model && this.glowMesh) {\n    //  this.model.remove(this.glowMesh);\n    //}\n    if (this.model && this.accessoryMesh) {\n      this.model.remove(this.accessoryMesh);\n    }\n    if (this.speechMesh) {\n      this.scene.remove(this.speechMesh);\n    }\n    this.container.removeChild(this.renderer.domElement);\n  }\n\n  private _setColorByPriority(priority: GhostPriority) {\n    if (!this.model) return;\n    // Dezente Statusfarben für die Grundfarbe\n    let color = 0xffffff;\n    switch (priority) {\n      case 'alert': color = 0xffcccc; break; // sanftes Rot\n      case 'warn': color = 0xfff4cc; break; // sanftes Gelb\n      case 'info': color = 0xcce6ff; break; // sanftes Blau\n      case 'ok': color = 0xffffff; break;\n    }\n    const emissive = 0x000000;\n    this.model.traverse((obj: any) => {\n      if (obj.isMesh && obj.material) {\n        obj.material.color?.set(color);\n        if (obj.material.emissive) {\n          obj.material.emissive.set(emissive);\n        }\n      }\n    });\n  }\n\nprivate _addAccessory() {\n    if (!this.model) return;\n    const now = Date.now();\n    if (this.accessoryMesh && this.model.children.includes(this.accessoryMesh)) {\n        // Prüfen, ob das Intervall überschritten ist\n        if (now - this.lastAccessoryUpdate < this.accessoryUpdateInterval) {\n            // Noch nicht genug Zeit vergangen, Accessoires nicht neu setzen\n            return;\n        }\n        this.model.remove(this.accessoryMesh);\n    }\n    this.lastAccessoryUpdate = now;\n\n    // --- Hat (existing) ---\n    const hatGeometry = new THREE.CylinderGeometry(0.11, 0.11, 0.07, 32);\n    const hatMaterial = new THREE.MeshBasicMaterial({ color: 0x222222 });\n    const hat = new THREE.Mesh(hatGeometry, hatMaterial);\n    hat.position.set(0, 0.38, 0);\n    const brimGeo = new THREE.CylinderGeometry(0.17, 0.17, 0.015, 32);\n    const brim = new THREE.Mesh(brimGeo, hatMaterial);\n    brim.position.set(0, -0.045, 0);\n    hat.add(brim);\n\n    // --- Sunglasses ---\n    const glasses = new THREE.Group();\n    const glassMat = new THREE.MeshBasicMaterial({ color: 0x111111 });\n    const frameMat = new THREE.MeshBasicMaterial({ color: 0x333333 });\n    // Left lens\n    const lensL = new THREE.Mesh(new THREE.CylinderGeometry(0.07, 0.07, 0.012, 32), glassMat);\n    lensL.rotation.x = Math.PI / 2;\n    lensL.position.set(-0.09, 0.23, 0.18);\n    // Right lens\n    const lensR = lensL.clone();\n    lensR.position.x = 0.09;\n    // Bridge\n    const bridge = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.012, 0.012), frameMat);\n    bridge.position.set(0, 0.23, 0.18);\n    // Left arm\n    const armL = new THREE.Mesh(new THREE.BoxGeometry(0.06, 0.01, 0.01), frameMat);\n    armL.position.set(-0.16, 0.23, 0.15);\n    armL.rotation.y = Math.PI / 8;\n    // Right arm\n    const armR = armL.clone();\n    armR.position.x = 0.16;\n    armR.rotation.y = -Math.PI / 8;\n    glasses.add(lensL, lensR, bridge, armL, armR);\n\n    // --- Sweater (simple torus as collar) ---\n    const collarGeo = new THREE.TorusGeometry(0.19, 0.025, 16, 100);\n    const collarMat = new THREE.MeshBasicMaterial({ color: 0x3366cc });\n    const collar = new THREE.Mesh(collarGeo, collarMat);\n    collar.position.set(0, 0.05, 0);\n    collar.rotation.x = Math.PI / 2;\n\n    // --- Umbrella ---\n    const umbrella = new THREE.Group();\n    // Canopy\n    const canopyGeo = new THREE.SphereGeometry(0.28, 24, 16, 0, Math.PI * 2, 0, Math.PI / 2);\n    const canopyMat = new THREE.MeshBasicMaterial({ color: 0xff4081, transparent: true, opacity: 0.85 });\n    const canopy = new THREE.Mesh(canopyGeo, canopyMat);\n    canopy.position.set(0.32, 0.55, 0);\n    // Stick\n    const stickGeo = new THREE.CylinderGeometry(0.012, 0.012, 0.38, 16);\n    const stickMat = new THREE.MeshBasicMaterial({ color: 0x888888 });\n    const stick = new THREE.Mesh(stickGeo, stickMat);\n    stick.position.set(0.32, 0.36, 0);\n    // Handle\n    const handleGeo = new THREE.TorusGeometry(0.03, 0.008, 8, 16, Math.PI);\n    const handleMat = new THREE.MeshBasicMaterial({ color: 0x444444 });\n    const handle = new THREE.Mesh(handleGeo, handleMat);\n    handle.position.set(0.32, 0.17, 0.03);\n    handle.rotation.z = Math.PI / 2;\n    umbrella.add(canopy, stick, handle);\n\n    // Add all accessories to a group for easy removal\n    const accessories = new THREE.Group();\n    const todayWeather = (window as any).hausgeistWeatherToday || {};\n    accessories.add(hat); // Hut immer\n    if (todayWeather.sunny) accessories.add(glasses);\n    if (typeof todayWeather.low === 'number' && todayWeather.low < 10) accessories.add(collar);\n    if (todayWeather.rain) accessories.add(umbrella);\n    this.model.add(accessories);\n    // Fix: accessoryMesh should be a Group, not a Mesh, so change its type to Object3D\n    this.accessoryMesh = accessories as unknown as THREE.Mesh;\n}\n/*\n  private _updateGlow(priority: GhostPriority) {\n    if (!this.model) return;\n    if (this.glowMesh && this.model.children.includes(this.glowMesh)) {\n      this.model.remove(this.glowMesh);\n      this.glowMesh.geometry.dispose();\n      (this.glowMesh.material as THREE.Material).dispose();\n      this.glowMesh = undefined;\n    }\n    let glowColor: number | null = null;\n    let glowOpacity = 0.18;\n    switch (priority) {\n      case 'alert': glowColor = 0xff4444; glowOpacity = 0.22; break;\n      case 'warn': glowColor = 0xffc107; glowOpacity = 0.13; break;\n      case 'info': glowColor = 0x2196f3; glowOpacity = 0.10; break;\n      default: return;\n    }\n    const geometry = new THREE.SphereGeometry(0.62, 32, 32);\n    const material = new THREE.MeshBasicMaterial({ \n      color: glowColor, \n      transparent: true, \n      opacity: glowOpacity, \n      depthWrite: false,\n      blending: THREE.AdditiveBlending\n    });\n    const glow = new THREE.Mesh(geometry, material);\n    glow.position.set(0, 0.38, 0);\n    this.model.add(glow);\n    this.glowMesh = glow;\n  }\n*/\n  private _createSpeechBubble(text: string) {\n    this.speechCanvas = document.createElement('canvas');\n    this.speechCanvas.width = 256;\n    this.speechCanvas.height = 96;\n    this.speechCtx = this.speechCanvas.getContext('2d');\n    this._updateSpeechTexture(text);\n    this.speechTexture = new THREE.Texture(this.speechCanvas);\n    this.speechTexture.needsUpdate = true;\n    const geometry = new THREE.PlaneGeometry(1.6, 0.6);\n    const material = new THREE.MeshBasicMaterial({ map: this.speechTexture, transparent: true });\n    this.speechMesh = new THREE.Mesh(geometry, material);\n    this.speechMesh.position.set(0, this.speechBubbleYOffset, 0);\n    this.speechMesh.renderOrder = 2;\n    this.scene.add(this.speechMesh);\n  }\n\n  private _updateSpeechTexture(text: string) {\n    if (!this.speechCanvas || !this.speechCtx) return;\n    const ctx = this.speechCtx;\n    const padding = 10;\n    const maxWidth = this.speechCanvas.width - padding * 2;\n    const lineHeight = 24;\n    const x = this.speechCanvas.width / 2;\n    const yStart = 28;\n\n    ctx.clearRect(0, 0, this.speechCanvas.width, this.speechCanvas.height);\n    ctx.fillStyle = 'rgba(255,255,255,0.95)';\n    ctx.strokeStyle = 'rgba(180,180,180,0.7)';\n    ctx.lineWidth = 3;\n\n    ctx.beginPath();\n    ctx.moveTo(20, 10);\n    ctx.lineTo(236, 10);\n    ctx.quadraticCurveTo(246, 10, 246, 26);\n    ctx.lineTo(246, 70);\n    ctx.quadraticCurveTo(246, 86, 236, 86);\n    ctx.lineTo(20, 86);\n    ctx.quadraticCurveTo(10, 86, 10, 70);\n    ctx.lineTo(10, 26);\n    ctx.quadraticCurveTo(10, 10, 20, 10);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(128, 86);\n    ctx.lineTo(138, 106);\n    ctx.lineTo(118, 86);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.font = 'bold 20px sans-serif';\n    ctx.fillStyle = '#222';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    const lines = this._wrapText(ctx, text, maxWidth);\n    const textHeight = lines.length * lineHeight;\n    const yOffset = yStart + (60 - textHeight) / 2;\n\n    lines.forEach((line, i) => {\n      ctx.fillText(line, x, yOffset + i * lineHeight);\n    });\n\n    if (this.speechTexture) {\n      this.speechTexture.needsUpdate = true;\n    }\n  }\n\n  private _wrapText(ctx: CanvasRenderingContext2D, text: string, maxWidth: number): string[] {\n    const words = text.split(' ');\n    const lines: string[] = [];\n    let line = '';\n\n    for (let i = 0; i < words.length; i++) {\n      const testLine = line + words[i] + ' ';\n      const metrics = ctx.measureText(testLine);\n      if (metrics.width > maxWidth && i > 0) {\n        lines.push(line.trim());\n        line = words[i] + ' ';\n      } else {\n        line = testLine;\n      }\n    }\n    lines.push(line.trim());\n    return lines;\n  }\n\n  private _isTabVisible(): boolean {\n    return !(document.hidden || (document.visibilityState && document.visibilityState !== 'visible'));\n  }\n\n  private _animate() {\n    if (!this.model) return;\n    const animateFn = () => {\n      if (!this._isTabVisible()) {\n        this.animationId = requestAnimationFrame(animateFn);\n        return;\n      }\n      const t = performance.now() * 0.001;\n      if (this.model) {\n        this.model.position.y = 0.5 + Math.sin(t * 2) * 0.1;\n        this.model.rotation.y = Math.sin(t * 0.5) * 0.3;\n        this.model.rotation.z = Math.sin(t * 1.2) * 0.05;\n      }\n      if (this.accessoryMesh) {\n        this.accessoryMesh.position.x = 0;\n        this.accessoryMesh.position.z = 0;\n      }\n      if (this.speechMesh && this.model) {\n        this.speechMesh.position.x = this.model.position.x;\n        this.speechMesh.position.z = this.model.position.z;\n        this.speechMesh.position.y = this.model.position.y + 0.9;\n        this.speechMesh.lookAt(this.camera.position);\n      }\n      this.renderer.render(this.scene, this.camera);\n      this.animationId = requestAnimationFrame(animateFn);\n    };\n    animateFn();\n  }\n}\n"]}